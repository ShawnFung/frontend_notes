# 渲染机制
- 什么是DOCTYPE及作用
- 浏览器渲染过程
- 重排Reflow
- 重绘Repaint
- 布局Layout

## DOCTYPE及作用
DTD是一系列的语法规则，用来定义XML或者(X)HTML的文件类型。浏览器会使用它来判断文档类型，决定使用何种协议来解析，以及切换浏览器模式。  
DOCTYPE是用来声明文档类型和DTD规范的，一个主要的用途便是文件的合法性验证。如果文件代码不合法，那么浏览器解析时便会出一些差错。

## 浏览器渲染流程
![浏览器渲染流程](../../images/浏览器渲染流程.png)
浏览器器内核拿到内容后，渲染大概可以划分成以下几个步骤：
1. 解析html建立dom树
2. 解析css构建render树（将CSS代码解析成树形的数据结构，然后结合DOM合并成render树）
3. 布局render树（Layout/reflow），负责各元素尺寸、位置的计算
4. 绘制render树（paint），绘制页面像素信息
5. 浏览器会将各层的信息发送给GPU，GPU会将各层合成（composite），显示在屏幕上。  

所有详细步骤都已经略去，渲染完毕后就是load事件了，之后就是自己的JS逻辑处理了。

Q：load事件与DOMContentLoaded事件的先后？
- 当 DOMContentLoaded 事件触发时，仅当DOM加载完成，不包括样式表，图片。 (譬如如果有async加载的脚本就不一定完成)
- 当 onload 事件触发时，页面上所有的DOM，样式表，脚本，图片都已经加载完成了。 （渲染完毕了）  

所以，顺序是：DOMContentLoaded -> load

Q：css加载是否会阻塞dom树渲染？
css是由单独的下载线程异步下载的。所以：
- css加载不会阻塞DOM树解析（异步加载时DOM照常构建）
- 但会阻塞render树渲染（渲染时需等css加载完毕，因为render树需要css信息）
