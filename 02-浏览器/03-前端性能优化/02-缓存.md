# 浏览器缓存

## 缓存的分类
- 强缓存
  - Expires，
  - Cache-Control
- 协商缓存
  - Last-Modified  If-Modified-Since
  - Etag  If-None-Match
  
## HTTP缓存体系
### 1.缓存存储策略
用来确定 HTTP 响应内容是否可以被客户端缓存，以及可以被哪些客户端缓存。
- 缓存文件数据：Cache-Control 中的 Public、Private、no-cache、max-age 都会缓存文件数据。
- 不缓存文件数据：no-store 不会在客户端缓存任何响应数据。

### 2.缓存过期策略
客户端用来确认存储在本地的缓存数据是否过期，进而决定是否要发请求到服务端获取数据。
- Cache-Control 中的 max-age 相对时间，优先级 > Expires
- Expires，http1.0版有效，绝对时间

### 3.缓存对比策略（协商缓存）
- Etag  If-None-Match，优先级 > Last-Modified
- Last-Modified  If-Modified-Since

## 分级缓存策略
- 200(from cache)，这一层由缓存过期策略控制（即expires/cache-control），如果没有过期，则使用本地缓存。
- 304，这一层由缓存对比策略控制（即Etag/Last-modified），如果文件没有修改过，则返回304。
- 200，当浏览器本地没有缓存，或者缓存过期，或者用户点击了 Ctrl + F5时，服务器会返回文件数据给浏览器。

缓存流程图
![缓存流程图](../../images/缓存流程图.png)

## Cache-Control
- no-store 不会在客户端缓存任何响应数据。
- no-cache 数据有缓存在客户端，但是在使用缓存之前，需要去服务端进行验证。
- max-age=相对时间，缓存未过期，则直接使用浏览器缓存。
- s-maxage=相对时间，同 max-age，但仅应用于共享缓存（如代理）
- public
- private

1. no-cache 和 max-age=0 的作用是差不多，都要求在使用缓存之前，去服务端进行验证。

## 参考文档
- [HTTP基于缓存策略三要素分解法](http://caibaojian.com/http-cache-3.html)
